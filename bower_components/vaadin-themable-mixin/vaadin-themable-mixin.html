<link rel="import" href="../polymer/lib/elements/dom-module.html">

<script>
if (Polymer && Polymer.version.indexOf('2.') !== 0) {
  throw new Error('Unexpected Polymer version ' + Polymer.version + ' is used, expected v2.0.0 or later.');
}

window.Vaadin = window.Vaadin || {};

/**
 * @polymerMixin
 */
Vaadin.ThemableMixin = function (superClass) {
  return function (_superClass) {
    babelHelpers.inherits(VaadinThemableMixin, _superClass);

    function VaadinThemableMixin() {
      babelHelpers.classCallCheck(this, VaadinThemableMixin);
      return babelHelpers.possibleConstructorReturn(this, (VaadinThemableMixin.__proto__ || Object.getPrototypeOf(VaadinThemableMixin)).apply(this, arguments));
    }

    babelHelpers.createClass(VaadinThemableMixin, null, [{
      key: '_includeStyle',


      /** @private */
      value: function _includeStyle(moduleName) {
        var styleEl = document.createElement('style');
        styleEl.setAttribute('include', moduleName);
        this._memoizedThemableMixinTemplate.content.appendChild(styleEl);
      }
    }, {
      key: 'template',
      get: function get() {
        var _this2 = this;

        var modules = Polymer.DomModule.prototype.modules;

        if (babelHelpers.get(VaadinThemableMixin.__proto__ || Object.getPrototypeOf(VaadinThemableMixin), 'template', this) && !this.hasOwnProperty('_memoizedThemableMixinTemplate')) {
          this._memoizedThemableMixinTemplate = babelHelpers.get(VaadinThemableMixin.__proto__ || Object.getPrototypeOf(VaadinThemableMixin), 'template', this).cloneNode(true);

          var hasThemes = false;
          var defaultModuleName = this.is + '-default-theme';

          Object.keys(modules).forEach(function (moduleName) {
            if (moduleName !== defaultModuleName) {
              var themeFor = modules[moduleName].getAttribute('theme-for');
              if (themeFor) {
                themeFor.split(' ').forEach(function (themeForToken) {
                  if (new RegExp('^' + themeForToken.split('*').join('.*') + '$').test(_this2.is)) {
                    hasThemes = true;
                    _this2._includeStyle(moduleName);
                  }
                });
              }
            }
          });

          if (!hasThemes && modules[defaultModuleName]) {
            // No theme modules found, include the default module if it exists
            this._includeStyle(defaultModuleName);
          }
        }
        return this._memoizedThemableMixinTemplate;
      }
    }]);
    return VaadinThemableMixin;
  }(superClass);
};</script>
