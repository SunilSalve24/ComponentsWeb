<link rel="import" href="./t-page-mixin.html">

<script>
    (() => {
        'use strict';

        /* @polymerMixin */
        const TSearchPageMixin = superClass => {

            return class extends TPageMixin(superClass) {

                constructor() {
                    super();                  
                }
                static get properties() {
                    return {
                        searchId: {
                            type: String,
                            notify: true
                        },
                        // Searched Data of the component.
                        searchedData: {
                            type: Object,
                            notify: true
                        }
                    };
                }
                /*
                 * <p>Event handler method called when `search` event is fired</p>
                 */
                onSearch(e) {
                    this._showProgress(true);
                    this.searchRequest = e.detail;
                    this._saveInSessionStore(this._sessionKeys.searchCriteria, e.detail);
                }

                /*
                 * <p>Event handler method called when `search-api-success` event is fired</p>
                 */
                onSearchSuccess(e) {
                    if (!e.detail) {
                        this.$.notify.active = true;
                        this.$.notify.message = event.detail.code + ' - ' + event.detail.message;
                        console.error('something blew up!');
                        return;
                    }
                    //setting the search Id global for all pages in app
                    this.searchId = e.detail.searchId;

                    this.queryParams = {
                        searchId: this.searchId
                    };

                    this.fire('search-page-success', {
                        product: this.productName,
                        data: this.searchedData,
                        searchId: e.detail.searchId
                    });

                }

                /*
                 * <p>Event handler method called when `search-api-error` event is fired</p>
                 */
                onSearchError(e) {
                    this._showProgress(false);
                    this.$.notify.active = true;
                    this.$.notify.message = event.detail.code + ' - ' + event.detail.message;
                    //console.error(e.detail);
                    this.fire('search-error', e.detail);
                }
            }
        };
        window.TSearchPageMixin = TSearchPageMixin;
    })();
</script>